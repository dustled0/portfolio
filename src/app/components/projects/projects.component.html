<section id="projects" class="section" aria-labelledby="projects-title">
  <div class="container">
    <h2 id="projects-title" class="section__title" appScrollReveal>Featured Projects</h2>

    <div class="projects__controls" appScrollReveal [delay]="50">
      <div class="projects__search">
        <i class="fas fa-search" aria-hidden="true"></i>
        <input
          type="text"
          [(ngModel)]="searchQuery"
          placeholder="Search projects..."
          class="projects__search-input"
          aria-label="Search projects"
          aria-describedby="projects-search-status">
      </div>

      <div class="projects__filters" role="group" aria-label="Filter projects by technology">
        @for (tech of allTechnologies; track tech) {
          <button
            class="projects__filter-chip"
            [class.projects__filter-chip--active]="activeFilter === tech"
            [attr.aria-pressed]="activeFilter === tech"
            (click)="setFilter(tech)">
            {{ tech }}
          </button>
        }
      </div>
    </div>

    <div class="projects" role="list" aria-live="polite">
      @for (project of filteredProjects; track project.name; let i = $index) {
        <article class="project card" [class.project--featured]="project.featured" role="listitem" appScrollReveal [delay]="i * 100" appMouseFollow [intensity]="5" (click)="openProjectModal(project)">
          @if (project.featured) {
            <div class="project__badge">
              <i class="fas fa-star" aria-hidden="true"></i>
              Featured
            </div>
          }
          <div class="project__screenshot" 
               (mouseenter)="playVideo($event)" 
               (mouseleave)="pauseVideo($event)">
            @if (project.videoDemo) {
              <video class="project__video" 
                     [src]="project.videoDemo" 
                     muted 
                     loop 
                     playsinline
                     preload="metadata"
                     aria-label="Project demo video">
              </video>
            } @else if (project.gifDemo) {
              <img class="project__gif" 
                   [src]="project.gifDemo" 
                   [alt]="project.name + ' demo'"
                   loading="lazy">
            }
            <div class="project__screenshot-placeholder" 
                 [class.project__screenshot-placeholder--hidden]="project.videoDemo || project.gifDemo"
                 [attr.data-icon]="project.icon || 'fas fa-folder-open'">
              <i [class]="project.icon || 'fas fa-folder-open'" aria-hidden="true"></i>
            </div>
            <div class="project__screenshot-overlay">
              <span class="project__screenshot-label">
                @if (project.videoDemo || project.gifDemo) {
                  <i class="fas fa-play" aria-hidden="true"></i> Watch Demo
                } @else {
                  View Project
                }
              </span>
            </div>
          </div>
          <div class="project__content">
            <h3 class="project__name">{{ project.name }}</h3>
            <p class="project__company">
              <i class="fas fa-building" aria-hidden="true"></i>
              {{ project.company }}
            </p>
            <p class="project__description">{{ project.description }}</p>
            <div class="project__technologies" aria-label="Technologies used">
              @for (tech of project.technologies; track tech) {
                <span class="tag">{{ tech }}</span>
              }
            </div>
          </div>
        </article>
      }
    </div>

    @if (filteredProjects.length === 0) {
      <div id="projects-search-status" class="projects__no-results" appScrollReveal role="status" aria-live="polite">
        <i class="fas fa-search" aria-hidden="true"></i>
        <p>No projects found matching your criteria.</p>
        <button class="btn btn--secondary" (click)="activeFilter = 'All'; searchQuery = ''">
          Clear filters
        </button>
      </div>
    }
  </div>
</section>

<app-project-modal
  [project]="selectedProject"
  [isOpen]="isModalOpen"
  (closeModal)="closeProjectModal()">
</app-project-modal>
